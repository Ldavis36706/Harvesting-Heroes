<!DOCTYPE html>
<html>

<head>
    <title>Harvesting Heroes</title>
    <link rel="icon" href="bountifulharvest.jpeg">
    <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
    <div id="header">
        <table>
            <tr>
                <td><img src="bountifulharvest.jpeg"></td>
                <td>Harvesting Heroes</td>
            </tr>
        </table>
    </div>
    <div class="nav-menu">
        <a href="#harvests-link">Harvests</a>
        <a href="#our-mission-link">Our Mission</a>
        <a href="#grow-goal-link">Grow Goal</a>
        <a href="#about-us-link">About Us</a>
    </div>

    <!-- Harvests section -->
    <div class="products" id="harvests-link">
        <h2>Harvests</h2>
        <table>
            <tr>
                <td><img src="basketharvest.jpeg"><p>Bountiful Harvest</p></td>
                <td><img src="adamwatermelon.jpeg"><p>Adam Harvesting a Watermelon</p></td>
                <td><img src="hugewatermelon.jpeg"><p>Kesha's Huge Watermelon </p></td>
            </tr>
            <tr>
                <td><img src="shellingpeas.jpeg"><p>Shelling Peas</p></td>
                <td><img src="Malik & Nia harvesting onions.jpg"><p>Malik & Nia Onion Harvest</p></td>
                <td><img src="peaches.jpeg"><p>Peach Harvest</p></td>
            </tr>
        </table>
    </div>

    <!-- Grow Goal section with Harvest Tracker -->
    <div class="sidebar">
        <div class="location" id="grow-goal-link">
            <h2>Grow Goal</h2>
            <p>Our goal is to grow 500 lbs of food this season!</p>
            <div class="tracker-container">
                <h3>Harvest Tracker</h3>
                <p id="trackerMessage">Loading...</p>
            </div>
            <h2>Enter Harvest Data</h2>
            <form id="harvestForm">
                <label for="plantName">Plant Name:</label>
                <select id="plantName" required>
                    <option value="">Select a plant</option>
                    <option value="Tomato">Tomato</option>
                    <option value="Cabbage">Cabbage</option>
                    <option value="Carrot">Carrot</option>
                    <option value="Lettuce">Lettuce</option>
                </select>

                <label for="harvestDate">Harvest Date:</label>
                <input type="date" id="harvestDate" required>

                <label for="location">Harvest Location:</label>
                <select id="location" required>
                    <option value="">Select a location</option>
                    <option value="Raised Bed 1">Raised Bed 1</option>
                    <option value="Raised Bed 2">Raised Bed 2</option>
                    <option value="Greenhouse">Greenhouse</option>
                    <option value="Backyard Garden">Backyard Garden</option>
                </select>

                <label for="weight">Weight Harvested (lbs):</label>
                <input type="number" id="weight" step="0.1" required>

                <button type="button" onclick="addHarvest()">Add to List</button>
                <button type="button" onclick="submitAll()">Submit to Database</button>
            </form>
            <h3>Harvest List</h3>
            <ul id="harvestList"></ul>
        </div>
    </div>

    <div class="about-us" id="about-us-link">
        <h2>About Us</h2>
        <p>Welcome to Harvesting Heroes, where we show how easy it is to grow food, no matter your space or resources. Follow along on this exciting journey with us.</p>
    </div>

    <div class="services" id="our-mission-link">
        <h2>Our Mission</h2>
        <p>Grow Big. Harvest More. Inspire Others.</p>
    </div>
    
    <script>
        let harvestEntries = [];

        function addHarvest() {
            const plantName = document.getElementById('plantName').value;
            const harvestDate = document.getElementById('harvestDate').value;
            const weight = document.getElementById('weight').value;
            const location = document.getElementById('location').value;

            if (!plantName || !harvestDate || !weight || !location) {
                alert("Please fill in all fields.");
                return;
            }

            const entry = { plantName, harvestDate, weight, location };
            harvestEntries.push(entry);

            updateHarvestList();
        }

        function updateHarvestList() {
            const list = document.getElementById('harvestList');
            list.innerHTML = "";

            harvestEntries.forEach((entry, index) => {
                const listItem = document.createElement("li");
                listItem.textContent = `${entry.plantName} - ${entry.weight} lbs on ${entry.harvestDate} (${entry.location})`;

                const deleteButton = document.createElement("button");
                deleteButton.textContent = "üóë Delete";
                deleteButton.className = "delete-btn";
                deleteButton.onclick = () => deleteEntry(index);

                listItem.appendChild(deleteButton);
                list.appendChild(listItem);
            });
        }

        function deleteEntry(index) {
            harvestEntries.splice(index, 1);
            updateHarvestList();
        }

        async function submitAll() {
            if (harvestEntries.length === 0) {
                alert("No harvests to submit.");
                return;
            }

            try {
                const response = await fetch("https://1ysvae9t7h.execute-api.us-east-1.amazonaws.com/prod/harvestEntryHandler", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ harvests: harvestEntries })
                });

                if (!response.ok) throw new Error("API request failed");

                const result = await response.json();
                alert("‚úÖ Submission Successful: " + result.message);

                harvestEntries = [];
                updateHarvestList();
                if (typeof updateTracker === 'function') { updateTracker(); }
            } catch (error) {
                alert("‚ùå Error submitting data: " + error.message);
            }
        }

        window.onload = function() { if (typeof updateTracker === 'function') { updateTracker(); } };
    </script>
</body>
</html>
