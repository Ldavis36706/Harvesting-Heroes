<h3>Harvest List</h3>
<ul id="harvestList"></ul>

<button type="button" onclick="submitAll()">Submit All</button>

<script>
    let harvestEntries = [];

    function addHarvest() {
        const plantName = document.getElementById('plantName').value;
        const harvestDate = document.getElementById('harvestDate').value;
        const weight = document.getElementById('weight').value;
        const location = document.getElementById('location').value;
        const password = document.getElementById('password').value;

        if (!plantName || !harvestDate || !weight || !location || !password) {
            alert("Please fill in all fields.");
            return;
        }

        const entry = { plantName, harvestDate, weight, location, password };
        harvestEntries.push(entry);

        updateHarvestList();
        
        // Clear inputs
        document.getElementById('plantName').value = "";
        document.getElementById('harvestDate').value = "";
        document.getElementById('weight').value = "";
        document.getElementById('location').value = "";
        document.getElementById('password').value = "";
    }

    function updateHarvestList() {
        const list = document.getElementById('harvestList');
        list.innerHTML = "";

        harvestEntries.forEach((entry, index) => {
            const listItem = document.createElement("li");
            listItem.textContent = `${entry.plantName} - ${entry.weight} lbs on ${entry.harvestDate} (${entry.location}) `;

            const editButton = document.createElement("button");
            editButton.textContent = "‚úè Edit";
            editButton.style.marginLeft = "10px";
            editButton.onclick = () => editEntry(index);

            const deleteButton = document.createElement("button");
            deleteButton.textContent = "üóë Delete";
            deleteButton.style.marginLeft = "5px";
            deleteButton.onclick = () => deleteEntry(index);

            listItem.appendChild(editButton);
            listItem.appendChild(deleteButton);
            list.appendChild(listItem);
        });
    }

    function editEntry(index) {
        const entry = harvestEntries[index];
        document.getElementById('plantName').value = entry.plantName;
        document.getElementById('harvestDate').value = entry.harvestDate;
        document.getElementById('weight').value = entry.weight;
        document.getElementById('location').value = entry.location;
        document.getElementById('password').value = entry.password;

        harvestEntries.splice(index, 1); // Remove from list so it can be re-added after editing
        updateHarvestList();
    }

    function deleteEntry(index) {
        harvestEntries.splice(index, 1);
        updateHarvestList();
    }

    async function submitAll() {
        if (harvestEntries.length === 0) {
            alert("No harvests to submit.");
            return;
        }

        try {
            const response = await fetch('https://1ysvae9t7h.execute-api.us-east-1.amazonaws.com/prod/harvest', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ harvests: harvestEntries })
            });

            const result = await response.json();

            if (response.ok) {
                alert("‚úÖ Submission successful!");
                document.getElementById('harvestList').innerHTML = "";
                harvestEntries = [];
            } else {
                alert("‚ùå Error: " + result.message);
            }
        } catch (error) {
            alert("‚ùå Failed to submit. Please check your network or API Gateway.");
        }
    }
</script>
